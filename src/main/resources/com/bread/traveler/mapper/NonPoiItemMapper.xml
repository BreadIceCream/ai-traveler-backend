<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bread.traveler.mapper.NonPoiItemMapper" >
    <!-- 1. 定义 ResultMap -->
    <!-- autoMapping="true" 让 MP 自动映射其他没有特殊处理的字段 (如 id, name 等) -->
    <resultMap id="BaseResultMap" type="com.bread.traveler.entity.NonPoiItem" autoMapping="true">
        <!-- 2. 显式指定 ID (推荐，虽然 autoMapping 也能处理，但显式写出是好习惯) -->
        <id column="id" property="id"/>
        <!-- 3. 【核心修复】显式指定 status 字段的 typeHandler -->
        <result column="type" property="type" typeHandler="com.bread.traveler.enums.EnumTypeHandler"/>
    </resultMap>

    <select id="countNonPois" resultType="java.lang.Long">
        select count(*) from non_poi_item
        where private_user_id = #{userId}
        <if test="type != null">
            and type = #{type}::non_poi_type
        </if>
    </select>
    <select id="getPage" resultMap="BaseResultMap">
        select * from non_poi_item
        where private_user_id = #{userId}
        <if test="type != null">
            and type = #{type}::non_poi_type
        </if>
        order by created_at desc
        LIMIT #{pageSize} offset #{offset}
    </select>
</mapper>