# **ğŸŒ AI Traveler Backend (AI æ—…æ¸¸åŠ©æ‰‹åç«¯)**

è¿™æ˜¯ä¸€ä¸ªåŸºäº Spring Boot 3 å’Œ Spring AI æ„å»ºçš„æ™ºèƒ½æ—…æ¸¸è§„åˆ’åŠ©æ‰‹åç«¯ç³»ç»Ÿã€‚å®ƒåˆ©ç”¨å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ã€å‘é‡æ¨¡å‹ã€RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ã€MCPï¼ˆæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰å’Œåœ°ç†ç©ºé—´æ•°æ®ï¼Œä¸ºç”¨æˆ·æä¾›ä»çµæ„Ÿæ¿€å‘åˆ°è¡Œç¨‹è½åœ°çš„å…¨æµç¨‹æ™ºèƒ½åŒ–æœåŠ¡ã€‚

## **ğŸ“– é¡¹ç›®æ¦‚è¿°**

**AI Traveler**æ—¨åœ¨è§£å†³ä¼ ç»Ÿæ—…æ¸¸è§„åˆ’ä¸­ä¿¡æ¯ç¹æ‚ã€å†³ç­–å›°éš¾çš„ç—›ç‚¹ã€‚

æœ¬é¡¹ç›®ä½œä¸ºç³»ç»Ÿçš„**äº‘ç«¯å¤§è„‘**ï¼Œä¸ä»…æä¾›åŸºç¡€çš„ CRUD ä¸šåŠ¡æ”¯æŒï¼Œæ›´æ ¸å¿ƒçš„æ˜¯é›†æˆäº†å…ˆè¿›çš„ AI èƒ½åŠ›ã€‚é€šè¿‡æ•´åˆ **ZhipuAI/OpenAI** å¤§æ¨¡å‹ã€**é«˜å¾·åœ°å›¾ APIã€MCP** å’Œ **å®æ—¶ç½‘ç»œæœç´¢**ï¼Œå®ç°äº†åŸºäºè‡ªç„¶è¯­è¨€çš„æ™ºèƒ½æ¨èã€è¡Œç¨‹è‡ªåŠ¨ç”Ÿæˆã€ç½‘é¡µæ”»ç•¥æå–ä»¥åŠå¤šè½®å¯¹è¯å¼è§„åˆ’ã€‚

## **âœ¨ æ ¸å¿ƒåŠŸèƒ½**

### **ğŸ§  AI æ ¸å¿ƒèƒ½åŠ›**

* **æ™ºèƒ½å¤šè½®å¯¹è¯**ï¼šåŸºäºç”¨æˆ·è¾“å…¥çš„éœ€æ±‚æˆ–é—®é¢˜ï¼ˆå¦‚â€œé•¿æ²™æœ‰ä»€ä¹ˆå¥½ç©çš„ï¼Ÿä»æ©˜å­æ´²åˆ°äº”ä¸€å¹¿åœºæ€ä¹ˆèµ°ï¼Ÿâ€ï¼‰ï¼ŒLLM ä½¿ç”¨å†…ç½®å·¥å…·è¿›è¡Œç½‘ç»œæœç´¢ã€POIæœç´¢ã€è·¯å¾„è§„åˆ’ã€å¤©æ°”æŸ¥è¯¢ç­‰ï¼Œä¸ºç”¨æˆ·è¿›è¡Œæ¨èï¼Œå›ç­”ç”¨æˆ·é—®é¢˜ã€‚  
* **ç½‘é¡µæ”»ç•¥æå–**ï¼šåˆ©ç”¨ Jsoup \+ Boilerpipe \+ AIï¼ŒæŠ“å–å¹¶æ¸…æ´—æ—…æ¸¸æ”»ç•¥ç½‘é¡µå†…å®¹ï¼Œä»ä¸­æå–ç»“æ„åŒ–æ•°æ®ï¼ˆç¾é£Ÿã€æ´»åŠ¨ã€ç‰¹è‰²æ–‡åŒ–ç­‰ï¼‰ä¿å­˜å…¥åº“ã€‚  
* **æ™ºèƒ½æ—…ç¨‹ç”Ÿæˆ**ï¼šAIæ ¹æ®å¿ƒæ„¿å•ï¼Œç»“åˆåœ°ç†ä½ç½®ã€å¤©æ°”ä¿¡æ¯æ™ºèƒ½è§„åˆ’æ•´ä¸ªè¡Œç¨‹ï¼Œæ”¯æŒä»¥æ—¥ç¨‹ä¸ºå•ä½é‡æ–°è§„åˆ’ã€‚  
* **å¤šç»´è·¯å¾„è§„åˆ’**ï¼šæ ¹æ®èµ·ç‚¹å’Œç»ˆç‚¹ï¼Œä»æ­¥è¡Œã€éª‘è¡Œã€é©¾è½¦å’Œå…¬å…±äº¤é€šå¤šä¸ªç»´åº¦ç»™å‡ºè·¯å¾„è§„åˆ’ï¼Œå¹¶æä¾›ä¸€é”®å”¤èµ·é«˜å¾·åœ°å›¾URIã€‚

### **ğŸ—ºï¸ ä¸šåŠ¡åŠŸèƒ½æ¨¡å—**

* **POI & åœ°ç‚¹ç®¡ç†**ï¼šæ”¯æŒè¯­ä¹‰æœç´¢ï¼ˆPGVectorï¼‰ã€æ•°æ®åº“ç²¾ç¡®æœç´¢åŠå…¨ç½‘ API æ··åˆæœç´¢ã€‚  
* **éç»“æ„åŒ–èµ„æº (Non-POI)**ï¼šç®¡ç†â€œåƒçƒ¤é¸­â€ã€â€œé€›å¤œå¸‚â€ç­‰æ— å›ºå®šåæ ‡çš„æ³›æ´»åŠ¨é¡¹ç›®ã€‚  
* **å¿ƒæ„¿å•ç³»ç»Ÿ**ï¼šå°†æ„Ÿå…´è¶£çš„åœ°ç‚¹æš‚å­˜ï¼Œä½œä¸º AI è§„åˆ’çš„è¾“å…¥æºã€‚  
* **æ—…ç¨‹å…¨ç”Ÿå‘½å‘¨æœŸ**ï¼šåˆ›å»ºã€ç¼–è¾‘ã€çŠ¶æ€æµè½¬ã€æ‹–æ‹½æ’åºæ—¥ç¨‹é¡¹ã€‚  
* **ç”¨æˆ·ç®¡ç†**ï¼šæ”¯æŒé€šè¿‡Vectoræœç´¢åŒ¹é…å…´è¶£ç›¸ä¼¼çš„ç”¨æˆ·ã€‚  
* **å›¢é˜Ÿåä½œ**ï¼šæ”¯æŒæŸ¥çœ‹å…¬å¼€æ—…ç¨‹ï¼Œç”³è¯·/é‚€è¯·å¥½å‹ åŠ å…¥æ—…ç¨‹ï¼Œè®¾ç½® OWNER/EDITOR/VIEWER æƒé™ï¼Œå…±åŒç¼–è¾‘ã€‚  
* **èµ„äº§ç®¡ç†**ï¼š  
  * **å¤šåª’ä½“æ—¥å¿—**ï¼šå‘å¸ƒå›¾æ–‡æ¸¸è®°ï¼ˆé›†æˆé˜¿é‡Œäº‘ OSSï¼‰ã€‚  
  * **æ™ºèƒ½è®°è´¦**ï¼šå¤šå¸ç§æ”¯å‡ºè®°å½•ä¸åˆ†ç±»ç»Ÿè®¡ã€‚

## **ğŸ—ï¸ æŠ€æœ¯æ¶æ„**

æœ¬é¡¹ç›®é‡‡ç”¨**å‰åç«¯åˆ†ç¦»**æ¶æ„ï¼Œåç«¯é‡‡ç”¨**åˆ†å±‚æ¶æ„**è®¾è®¡ã€‚

### **æŠ€æœ¯æ ˆ**

| ç±»åˆ« | æŠ€æœ¯ç»„ä»¶ | è¯´æ˜ |
| :---- | :---- | :---- |
| **å¼€å‘è¯­è¨€** | Java 21 | åˆ©ç”¨æ–°ç‰¹æ€§æå‡å¼€å‘æ•ˆç‡ä¸æ€§èƒ½ |
| **æ ¸å¿ƒæ¡†æ¶** | Spring Boot 3.4.7 | åŠå…¶ç”Ÿæ€ç»„ä»¶ (Web, AOP, Test) |
| **AI æ¡†æ¶** | **Spring AI 1.1.0** | æ ¸å¿ƒ AI ç¼–æ’ï¼Œé›†æˆ ChatClient, Embedding, VectorStore |
| **æ¨¡å‹æœåŠ¡** | ZhipuAI / OpenAI | æ¥å…¥æ™ºè°± GLM-4 ç­‰å¤§æ¨¡å‹ |
| **ORM æ¡†æ¶** | MyBatis Plus 3.5.7 | ç®€åŒ–æ•°æ®åº“æ“ä½œï¼Œé…åˆè‡ªå®šä¹‰ TypeHandler å¤„ç† JSONB/Enum |
| **æ•°æ®åº“** | **PostgreSQL 16** | å…³ç³»å‹æ•°æ®å­˜å‚¨ |
| **å‘é‡æ•°æ®åº“** | **PGVector** | å­˜å‚¨æ–‡æœ¬åµŒå…¥å‘é‡ï¼Œæ”¯æŒè¯­ä¹‰æ£€ç´¢ |
| **å·¥å…·åè®®** | **MCP Client** | é›†æˆé«˜å¾·åœ°å›¾ MCP Serverï¼Œå®ç°æ ‡å‡†åŒ–çš„å·¥å…·è°ƒç”¨ |
| **å¯¹è±¡å­˜å‚¨** | Aliyun OSS | å›¾ç‰‡ç­‰éç»“æ„åŒ–æ•°æ®å­˜å‚¨ |
| **çˆ¬è™«å·¥å…·** | Jsoup \+ Boilerpipe | ç½‘é¡µå†…å®¹æŠ“å–ä¸æ­£æ–‡é™å™ªæå– |
| **API æ–‡æ¡£** | SpringDoc / Knife4j | OpenAPI 3 è§„èŒƒæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ |

### **æ ¸å¿ƒæœºåˆ¶**

1. **å‘é‡æ¨¡å‹+æ•°æ®åº“**ï¼šåˆ©ç”¨ PGVector å­˜å‚¨ç”¨æˆ·åå¥½å’Œ POI æè¿°çš„é«˜ç»´å‘é‡ï¼Œå®ç°ç”¨æˆ·å…´è¶£åŒ¹é…ã€è¯­ä¹‰æœç´¢POIã€‚  
2. **Function Calling (å·¥å…·è°ƒç”¨)**ï¼šLLM å¯è‡ªä¸»å†³å®šè°ƒç”¨é«˜å¾·åœ°å›¾ API æŸ¥è·¯çº¿ã€æŸ¥å¤©æ°”ï¼Œæˆ–è°ƒç”¨ç½‘ç»œæœç´¢å·¥å…·ã€‚  
3. **ç¼–ç¨‹å¼äº‹åŠ¡**ï¼šåœ¨å¤šçº¿ç¨‹å¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚ AI æ‰¹é‡è§£æç½‘é¡µï¼‰ä¸­ä½¿ç”¨ TransactionTemplate ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚
4. **Redisson åˆ†å¸ƒå¼é”**ï¼š
   *   **åˆ†å±‚é”æœºåˆ¶**ï¼šå®ç°äº† Trip(æ—…ç¨‹) -> Day(æ—¥ç¨‹) -> Item(äº‹é¡¹) ä¸‰å±‚ç²’åº¦çš„å¹¶å‘æ§åˆ¶ã€‚
   *   **è¯»å†™é” (ReadWriteLock)**ï¼šçˆ¶çº§ï¼ˆå¦‚ Tripï¼‰æŒæœ‰è¯»é”æ—¶ï¼Œå…è®¸å­çº§ï¼ˆå¦‚ Dayï¼‰ä¿®æ”¹ï¼›çˆ¶çº§æŒæœ‰å†™é”æ—¶ï¼Œç‹¬å æ•´ä¸ªåˆ†æ”¯ã€‚
   *   **è”é” (MultiLock)**ï¼šåŸå­æ€§ä¸€æ¬¡è·å–æ•´æ¡é“¾è·¯çš„é”ï¼ˆå¦‚ä¿®æ”¹ Item æ—¶ï¼Œè‡ªåŠ¨é”å®š Trip.Read + Day.Read + Item.Lockï¼‰ï¼Œé˜²æ­¢æ­»é”ã€‚
   *   **çœ‹é—¨ç‹— (Watchdog)**ï¼šè‡ªåŠ¨ç»­æœŸï¼Œé˜²æ­¢ä¸šåŠ¡é•¿è€—æ—¶å¯¼è‡´é”æ„å¤–é‡Šæ”¾ã€‚

## **ğŸš€ å¿«é€Ÿå¼€å§‹**

### **1\. ç¯å¢ƒå‡†å¤‡**

* **JDK**: 21+  
* **Maven**: 3.8+  
* **Docker**: ç”¨äºå¯åŠ¨æ•°æ®åº“

### **2\. å¯åŠ¨åŸºç¡€è®¾æ–½**

é¡¹ç›®æ ¹ç›®å½•ä¸‹æä¾›äº† docker-compose.ymlï¼Œç”¨äºå¿«é€Ÿå¯åŠ¨å¸¦æœ‰ pgvector æ’ä»¶çš„ PostgreSQLã€‚

```bash
docker-compose up \-d
```

### **3\. é…ç½®æ–‡ä»¶è®¾ç½®**

é¡¹ç›®é…ç½®æ–‡ä»¶ä½äº src/main/resources/application.yamlã€‚  
æ³¨æ„ï¼šæœ¬é¡¹ç›®ä½¿ç”¨äº†ç¯å¢ƒå˜é‡å ä½ç¬¦ï¼Œè¯·åœ¨ IDE çš„è¿è¡Œé…ç½®æˆ–ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­è®¾ç½®ä»¥ä¸‹ Keyï¼š

| ç¯å¢ƒå˜é‡å | è¯´æ˜ | ç¤ºä¾‹ |
| :---- | :---- | :---- |
| postgres-user | æ•°æ®åº“ç”¨æˆ·å | postgres |
| postgres-password | æ•°æ®åº“å¯†ç  | pg123456 (éœ€ä¸ docker-compose ä¸€è‡´) |
| ZHIPUAI\_API\_KEY | æ™ºè°± AI Key | See your dashboard |
| OPENAI\_API\_KEY | OpenAI Key | sk-... |
| OPENAI\_CHAT\_BASE\_URL | OpenAI ä»£ç†åœ°å€ | https://api.openai.com |
| GAODE\_API\_KEY | é«˜å¾·åœ°å›¾ Web æœåŠ¡ Key | See amap console |
| WEB\_SEARCH\_API\_KEY | ç½‘ç»œæœç´¢ API Key | See bocha.cn |
| ALIYUN\_OSS\_ENDPOINT | é˜¿é‡Œäº‘ OSS èŠ‚ç‚¹ | oss-cn-hangzhou.aliyuncs.com |
| ALIYUN\_OSS\_BUCKET\_NAME | Bucket åç§° | my-travel-bucket |
| ALIYUN\_OSS\_REGION | OSS åŒºåŸŸ | cn-hangzhou |
| ALIYUN\_ACCESS\_KEY\_ID | é˜¿é‡Œäº‘ AK (SDKè‡ªåŠ¨è¯»å–ï¼Œ éœ€é…ç½®ç¯å¢ƒå˜é‡) | \- |
| ALIYUN\_ACCESS\_KEY\_SECRET | é˜¿é‡Œäº‘ SK (SDKè‡ªåŠ¨è¯»å–ï¼Œ éœ€é…ç½®ç¯å¢ƒå˜é‡) | \- |

### **4\. æ•°æ®åº“åˆå§‹åŒ–**

é¡¹ç›®å¯åŠ¨åï¼ŒSpring AI ä¼šè‡ªåŠ¨åˆå§‹åŒ– spring\_ai\_chat\_memory è¡¨ã€‚  
ä¸šåŠ¡è¡¨ç»“æ„è¯·æ‰‹åŠ¨æ‰§è¡Œ SQL è„šæœ¬ï¼ˆä½äº src/main/resources/sql/ï¼‰ï¼š

1. type-ddl.sql (åˆ›å»ºæšä¸¾ç±»å‹)  
2. table-ddl.sql (åˆ›å»ºä¸šåŠ¡è¡¨)

### **5\. ç¼–è¯‘ä¸è¿è¡Œ**

```bash
# ç¼–è¯‘é¡¹ç›®
mvn clean package -DskipTests

# è¿è¡Œ
java -jar target/AI-Traveler-0.0.1-SNAPSHOT.jar
```

å¯åŠ¨æˆåŠŸåï¼Œè®¿é—® API æ–‡æ¡£ï¼š

* **Knife4j**:Â http://localhost:8080/api/doc.html

## **ğŸ“‚ é¡¹ç›®ç»“æ„**

```
com.bread.traveler  
â”œâ”€â”€ annotation      # è‡ªå®šä¹‰æ³¨è§£ (æƒé™æ ¡éªŒç­‰)  
â”œâ”€â”€ aspect          # AOP åˆ‡é¢ (å¤„ç† @TripAccessValidate ç­‰)  
â”œâ”€â”€ config          # å…¨å±€é…ç½® (AI, Web, Knife4j, Mybatis)  
â”œâ”€â”€ controller      # REST æ¥å£å±‚  
â”œâ”€â”€ dto             # æ•°æ®ä¼ è¾“å¯¹è±¡  
â”œâ”€â”€ entity          # æ•°æ®åº“å®ä½“  
â”œâ”€â”€ enums           # æšä¸¾å®šä¹‰ (TripStatus, RoleType ç­‰)  
â”œâ”€â”€ exception       # å…¨å±€å¼‚å¸¸å¤„ç†  
â”œâ”€â”€ mapper          # DAO å±‚ (MyBatis Plus)  
â”œâ”€â”€ service         # ä¸šåŠ¡é€»è¾‘å±‚ (å« AI ç¼–æ’é€»è¾‘)  
â”œâ”€â”€ tools           # AI Function Tools (WebSearch, POI Search)  
â”œâ”€â”€ typehandler     # MyBatis ç±»å‹å¤„ç†å™¨ (JSONB, Vector, UUID)  
â”œâ”€â”€ utils           # å·¥å…·ç±» (GaoDe, OSS, Crawler)  
â””â”€â”€ vo              # ç»Ÿä¸€å“åº”å¯¹è±¡  
```

